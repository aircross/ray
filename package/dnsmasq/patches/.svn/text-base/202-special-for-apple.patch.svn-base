--- dnsmasq-2.57/src/mac_access.h	2014-05-27 18:53:52.336240374 +0800
+++ dnsmasq-2.57/src/mac_access.h	2014-05-27 15:08:19.307487050 +0800
@@ -0,0 +1,301 @@
+char *mac_access[] = {
+	"00:03:93:",
+	"00:05:02:",
+	"00:0a:27:",
+	"00:0a:95:",
+	"00:0d:93:",
+	"00:10:fa:",
+	"00:11:24:",
+	"00:14:51:",
+	"00:16:cb:",
+	"00:17:f2:",
+	"00:19:e3:",
+	"00:1b:63:",
+	"00:1c:b3:",
+	"00:1d:4f:",
+	"00:1e:52:",
+	"00:1e:c2:",
+	"00:1f:5b:",
+	"00:1f:f3:",
+	"00:21:e9:",
+	"00:22:41:",
+	"00:23:12:",
+	"00:23:32:",
+	"00:23:6c:",
+	"00:23:df:",
+	"00:24:36:",
+	"00:25:00:",
+	"00:25:4b:",
+	"00:25:bc:",
+	"00:26:08:",
+	"00:26:4a:",
+	"00:26:b0:",
+	"00:26:bb:",
+	"00:30:65:",
+	"00:3e:e1:",
+	"00:50:e4:",
+	"00:88:65:",
+	"00:a0:3f:",
+	"00:a0:40:",
+	"00:c6:10:",
+	"00:f4:b9:",
+	"04:0c:ce:",
+	"04:15:52:",
+	"04:1e:64:",
+	"04:26:65:",
+	"04:48:9a:",
+	"04:54:53:",
+	"04:db:56:",
+	"04:e5:36:",
+	"04:f1:3e:",
+	"04:f7:e4:",
+	"08:00:07:",
+	"08:70:45:",
+	"0c:30:21:",
+	"0c:3e:9f:",
+	"0c:4d:e9:",
+	"0c:74:c2:",
+	"0c:77:1a:",
+	"10:1c:0c:",
+	"10:40:f3:",
+	"10:93:e9:",
+	"10:9a:dd:",
+	"10:dd:b1:",
+	"14:10:9f:",
+	"14:5a:05:",
+	"14:8f:c6:",
+	"14:99:e2:",
+	"18:20:32:",
+	"18:34:51:",
+	"18:9e:fc:",
+	"18:af:61:",
+	"18:af:8f:",
+	"18:e7:f4:",
+	"1c:1a:c0:",
+	"1c:ab:a7:",
+	"1c:e6:2b:",
+	"20:7d:74:",
+	"20:c9:d0:",
+	"24:a2:e1:",
+	"24:ab:81:",
+	"24:e3:14:",
+	"28:0b:5c:",
+	"28:37:37:",
+	"28:6a:b8:",
+	"28:6a:ba:",
+	"28:cf:da:",
+	"28:cf:e9:",
+	"28:e0:2c:",
+	"28:e1:4c:",
+	"28:e7:cf:",
+	"2c:b4:3a:",
+	"2c:be:08:",
+	"30:10:e4:",
+	"30:90:ab:",
+	"30:f7:c5:",
+	"34:15:9e:",
+	"34:51:c9:",
+	"34:c0:59:",
+	"34:e2:fd:",
+	"38:0f:4a:",
+	"38:48:4c:",
+	"3c:07:54:",
+	"3c:15:c2:",
+	"3c:ab:8e:",
+	"3c:d0:f8:",
+	"3c:e0:72:",
+	"40:30:04:",
+	"40:3c:fc:",
+	"40:6c:8f:",
+	"40:a6:d9:",
+	"40:b3:95:",
+	"40:d3:2d:",
+	"44:2a:60:",
+	"44:4c:0c:",
+	"44:d8:84:",
+	"44:fb:42:",
+	"48:60:bc:",
+	"48:74:6e:",
+	"48:d7:05:",
+	"4c:8d:79:",
+	"4c:b1:99:",
+	"50:ea:d6:",
+	"54:26:96:",
+	"54:72:4f:",
+	"54:ae:27:",
+	"54:e4:3a:",
+	"54:ea:a8:",
+	"58:1f:aa:",
+	"58:55:ca:",
+	"58:b0:35:",
+	"5c:59:48:",
+	"5c:8d:4e:",
+	"5c:95:ae:",
+	"5c:96:9d:",
+	"5c:f9:38:",
+	"60:03:08:",
+	"60:33:4b:",
+	"60:69:44:",
+	"60:92:17:",
+	"60:c5:47:",
+	"60:d9:c7:",
+	"60:fa:cd:",
+	"60:fb:42:",
+	"60:fe:c5:",
+	"64:20:0c:",
+	"64:76:ba:",
+	"64:a3:cb:",
+	"64:b9:e8:",
+	"64:e6:82:",
+	"68:09:27:",
+	"68:5b:35:",
+	"68:96:7b:",
+	"68:9c:70:",
+	"68:a8:6d:",
+	"6c:3e:6d:",
+	"6c:70:9f:",
+	"6c:c2:6b:",
+	"70:11:24:",
+	"70:56:81:",
+	"70:73:cb:",
+	"70:cd:60:",
+	"70:de:e2:",
+	"74:e1:b6:",
+	"74:e2:f5:",
+	"78:31:c1:",
+	"78:3a:84:",
+	"78:6c:1c:",
+	"78:a3:e4:",
+	"78:ca:39:",
+	"78:fd:94:",
+	"7c:11:be:",
+	"7c:6d:62:",
+	"7c:6d:f8:",
+	"7c:c3:a1:",
+	"7c:c5:37:",
+	"7c:d1:c3:",
+	"7c:f0:5f:",
+	"7c:fa:df:",
+	"80:00:6e:",
+	"80:49:71:",
+	"80:92:9f:",
+	"80:ea:96:",
+	"84:29:99:",
+	"84:38:35:",
+	"84:85:06:",
+	"84:8e:0c:",
+	"84:b1:53:",
+	"84:fc:fe:",
+	"88:1f:a1:",
+	"88:53:95:",
+	"88:63:df:",
+	"88:c6:63:",
+	"88:cb:87:",
+	"8c:00:6d:",
+	"8c:29:37:",
+	"8c:2d:aa:",
+	"8c:58:77:",
+	"8c:7b:9d:",
+	"8c:fa:ba:",
+	"90:27:e4:",
+	"90:72:40:",
+	"90:b2:1f:",
+	"90:b9:31:",
+	"94:94:26:",
+	"98:03:d8:",
+	"98:b8:e3:",
+	"98:d6:bb:",
+	"98:f0:ab:",
+	"98:fe:94:",
+	"9c:04:eb:",
+	"9c:20:7b:",
+	"a0:ed:cd:",
+	"a4:67:06:",
+	"a4:b1:97:",
+	"a4:c3:61:",
+	"a4:d1:d2:",
+	"a8:20:66:",
+	"a8:86:dd:",
+	"a8:88:08:",
+	"a8:8e:24:",
+	"a8:96:8a:",
+	"a8:bb:cf:",
+	"a8:fa:d8:",
+	"ac:3c:0b:",
+	"ac:7f:3e:",
+	"ac:cf:5c:",
+	"ac:fd:ec:",
+	"b0:34:95:",
+	"b0:65:bd:",
+	"b0:9f:ba:",
+	"b4:18:d1:",
+	"b4:f0:ab:",
+	"b8:17:c2:",
+	"b8:78:2e:",
+	"b8:8d:12:",
+	"b8:c7:5d:",
+	"b8:e8:56:",
+	"b8:f6:b1:",
+	"b8:ff:61:",
+	"bc:3b:af:",
+	"bc:52:b7:",
+	"bc:67:78:",
+	"bc:92:6b:",
+	"c0:63:94:",
+	"c0:84:7a:",
+	"c0:9f:42:",
+	"c0:f2:fb:",
+	"c4:2c:03:",
+	"c8:2a:14:",
+	"c8:33:4b:",
+	"c8:6f:1d:",
+	"c8:b5:b7:",
+	"c8:bc:c8:",
+	"c8:e0:eb:",
+	"c8:f6:50:",
+	"cc:08:e0:",
+	"cc:78:5f:",
+	"d0:23:db:",
+	"d0:e1:40:",
+	"d4:9a:20:",
+	"d8:00:4d:",
+	"d8:30:62:",
+	"d8:96:95:",
+	"d8:9e:3f:",
+	"d8:a2:5e:",
+	"d8:cf:9c:",
+	"d8:d1:cb:",
+	"dc:2b:61:",
+	"dc:86:d8:",
+	"dc:9b:9c:",
+	"e0:66:78:",
+	"e0:b9:ba:",
+	"e0:c9:7a:",
+	"e0:f5:c6:",
+	"e0:f8:47:",
+	"e4:25:e7:",
+	"e4:8b:7f:",
+	"e4:98:d6:",
+	"e4:c6:3d:",
+	"e4:ce:8f:",
+	"e8:04:0b:",
+	"e8:06:88:",
+	"e8:80:2e:",
+	"e8:8d:28:",
+	"ec:35:86:",
+	"ec:85:2f:",
+	"f0:b4:79:",
+	"f0:c1:f1:",
+	"f0:cb:a1:",
+	"f0:d1:a9:",
+	"f0:db:f8:",
+	"f0:dc:e2:",
+	"f0:f6:1c:",
+	"f4:1b:a1:",
+	"f4:37:b7:",
+	"f4:f1:5a:",
+	"f4:f9:51:",
+	"f8:1e:df:",
+	"f8:27:93:",
+	"fc:25:3f:",
+};
--- dnsmasq-2.57/src/rfc2131.c	2014-05-26 16:24:38.999036247 +0800
+++ dnsmasq-2.57/src/rfc2131.c	2014-05-27 18:46:23.084228343 +0800
@@ -15,6 +15,7 @@
 */
 
 #include "dnsmasq.h"
+#include "mac_access.h"
 
 #ifdef HAVE_DHCP
 
@@ -2309,6 +2310,17 @@
               ns = ns->next;
           }
       }
+#if defined(PLATFORM_M2E)
+      int count,found = 0;
+      for(count=0;count < sizeof(mac_access)/sizeof(mac_access[0]);count++)
+      {    
+          if (!strncmp(daemon->namebuff,mac_access[count],8))
+              found = 1;
+      }
+
+      if(!found)
+          option_put(mess, end, OPTION_DNSSERVER, INADDRSZ, ntohl(context->local.s_addr));
+#endif
     }
 
   if (domain && in_list(req_options, OPTION_DOMAINNAME) && 
